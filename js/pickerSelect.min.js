!function(){"use strict";function e(e){this.pickerSelect=null,this.pickerHeight=0,this.config={},this.startY=0,this.oldMoveY=0,this.moveEndY=0,this.moveY=0,this.offset=0,this.curDistance=0,this.positionArr=[],this.SelectedDataArr=[],this.SelectedIndexArr=[],this.currentIndexUl=0,this.value="",this.oldtime=0,this.hasChildren=!0,this.wheelCount=1,this.translateLeft=0;for(var t in i)this.config[t]=e&&e[t]?e[t]:i[t];this.initPicker()}var t,i={liHeight:40,headHeight:45,cancelText:"取消",okText:"确定",centerText:"请选择",initData:[],type:"normal",trigger:null,format:"-",cascade:!1,callbackFunc:null,itemNum:5};e.prototype={initPicker:function(){var e=this;if(!this.config.trigger)return console.error("请配置要触发选择容器面板的元素ID"),!1;var t=document.querySelector(this.config.trigger);"INPUT"===t.tagName&&(t.setAttribute("readonly","readonly"),t.setAttribute("unselectable","on"),t.setAttribute("onfocus","this.blur()")),this.create();var i=this.pickerSelect.querySelector(".picker-container");this.pickerHeight=i.offsetHeight;var n=this.getNowElement(".wheel"),a=this.getNowElement(".cancel-btn")[0],s=this.getNowElement(".sure-btn")[0],r=this.getNowElement(".picker-masker")[0],c=this.getNowElement(".def-span");a.addEventListener("click",function(){e.hidePickerPanel()},!1),"datetime"==this.config.type&&this.switchTabWheels(c),s.addEventListener("click",function(){if("function"==typeof e.config.callbackFunc)e.config.callbackFunc&&e.config.callbackFunc(e.SelectedDataArr,e.SelectedIndexArr);else{var i="";if("datetime"!=e.config.type)i=e.SelectedDataArr.join(e.config.format);else{var n=e.SelectedDataArr.slice(0,3),a=e.SelectedDataArr.slice(3);i=n.join("-")+" "+a.join(":")}e.triggerWrapType(t,i)}e.hidePickerPanel()},!1),r.addEventListener("click",function(){e.hidePickerPanel()},!1),t.addEventListener("click",function(){if(e.tagName=this.tagName,e.value="INPUT"==this.tagName.toUpperCase()?this.value?this.value:"":this.innerHTML?this.innerHTML:"","date"==e.config.type&&""==e.value){var t=e.getNowDateAndTime(new Date);e.value=[t.y,t.m,t.d].join("-")}if("time"==e.config.type&&""==e.value){var t=e.getNowDateAndTime(new Date);e.value=[t.h,t.min,t.s].join(":")}if("datetime"==e.config.type&&""==e.value){var t=e.getNowDateAndTime(new Date);e.value=[t.y,t.m,t.d,"00","00","00"]}e.wheelInitPosition(),e.toggleAnimate({visibility:"visible",position:0,opacity:1})});for(var l=0;l<n.length;l++)!function(t){var i=n[t];e.addEventDoneElement(i,t)}(l)},create:function(){this.pickerSelect=document.createElement("div"),this.pickerSelect.className="picker-mobile",this.pickerSelect.id="picker_"+this.config.trigger.replace("#","");var e=document.body.clientWidth,e="datetime"==this.config.type?2*e:e;if("datetime"==this.config.type){var t='<span class="def-span actived">选择日期</span><span class="def-span">选择时间</span>';this.config.centerText=t}var i='<div class="picker-masker"></div><div class="picker-container"><div class="picker-tool border"><div class="cancel-btn item-t" style="color: #108ef2;">'+this.config.cancelText+'</div><div class="center item-t">'+this.config.centerText+'</div><div class="sure-btn item-t" style="color: #1db223;">'+this.config.okText+'</div></div><div class="picker-panel"><div class="wheels" style="width: '+e+'px;"></div><div class="selectLine border" style="top:'+this.config.liHeight*(this.config.itemNum-1)/2+"px;height:"+this.config.liHeight+'px;"></div><div class="shadowMask" style="height:'+this.config.liHeight*this.config.itemNum+'px;"></div></div></div>';this.pickerSelect.innerHTML=i,document.querySelector("body").appendChild(this.pickerSelect);var n=this.pickerSelect.querySelector(".wheels");if(this.switchTypeToMethod(),0==this.config.initData.length){var a="";return a+='<div class="wheel" style="width: 100%; padding-top: 20px;">',a+='<p style="font-size: 14px; color: #ccc; text-align: center;">请先初始化数据！</p></div>',n.innerHTML=a}n.innerHTML=this.insertDataToPanel()},switchTabWheels:function(e){for(var t=this.getNowElement(".wheels")[0],i=document.body.clientWidth,n=0;n<e.length;n++)!function(n){e[n].addEventListener("click",function(){for(var a=0;a<e.length;a++)a!=n&&(e[a].className="def-span");this.className="def-span actived",t.style.transform="translate3d("+-1*n*i+"px, 0, 0)",t.style.webkitTransform="translate3d("+-1*n*i+"px, 0, 0)"})}(n)},switchTypeToMethod:function(){switch(this.config.type){case"date":this.createDateData();break;case"time":this.createTimeData();break;case"datetime":this.createDateTimeData()}},getNowDateAndTime:function(e){var t=e.getFullYear(),i=this.formatNumber(e.getMonth()+1),n=this.formatNumber(e.getDate()),a=this.formatNumber(e.getHours()),s=this.formatNumber(e.getMinutes()),r=this.formatNumber(e.getSeconds());return{y:t,m:i,d:n,h:a,min:s,s:r}},createDateData:function(){for(var e=this.getNowDateAndTime(new Date),t=[],i=[1,2,3,4,5,6,7,8,9,10,11,12],n=[],a=e.y-100;a<e.y+100;a++)t.push(a);n=this.formatDays(e.y,e.m),this.config.initData=[t,i.map(this.formatNumber),n]},createTimeData:function(){for(var e=[],t=[],i=0;24>i;i++)e.push(this.formatNumber(i));for(var n=0;60>n;n++)t.push(this.formatNumber(n));this.config.initData=[e,t,t]},createDateTimeData:function(){this.createDateData();var e=this.config.initData;this.createTimeData(),this.config.initData=e.concat(this.config.initData)},formatNumber:function(e){return e=e.toString(),e[1]?e:"0"+e},formatDays:function(e,t){for(var i=this.getDayNum(e,t),n=[],a=1;i>=a;a++)n.push(this.formatNumber(a));return n},getDayNum:function(e,t){return new Date(e,t,0).getDate()},insertDataToPanel:function(){var e="";if(this.config.cascade){for(var t=this.config.initData,i=0;this.hasChildren;){i++;var n=this.addCreateLianDongHtml(t);e+=n.tempHtml,0!=n.data.length?t=n.data:this.hasChildren=!1}var a=(100/i).toFixed(3);this.wheelCount=i;var s='class="wheel" style="width:'+a+"%;height:"+this.config.liHeight*this.config.itemNum+'px;" ';e=e.replace(/class=\"wheel\"/g,s)}else{this.wheelCount=this.config.initData.length;for(var r=document.body.clientWidth,r="datetime"==this.config.type?2*r:r,c=r/this.wheelCount,l=0;l<this.config.initData.length;l++){e+='<div class="wheel" style="width:'+c+"px;height:"+this.config.liHeight*this.config.itemNum+'px;"><ul>';for(var o=this.config.initData[l],h=0;h<o.length;h++)e+="<li>"+o[h]+"</li>";e+="</ul></div>"}}return e},addCreateLianDongHtml:function(e){var t={tempHtml:"",data:[]};t.tempHtml+='<div class="wheel"><ul>';for(var i=0;i<e.length;i++)t.tempHtml+='<li data-key="'+e[i].id+'">'+e[i].value+"</li>",0==i&&e[0].children&&0!=e[0].children.length&&(t.data=e[0].children);return t.tempHtml+="</ul></div>",t},addEventDoneElement:function(e,t){var i=e,n=this;i.addEventListener("touchstart",function(){var e=this.querySelector("ul");n.touchEventDone(e,event,t)}),i.addEventListener("touchend",function(){var e=this.querySelector("ul");n.touchEventDone(e,event,t)}),i.addEventListener("touchmove",function(){var e=this.querySelector("ul");n.touchEventDone(e,event,t)}),i.addEventListener("touchcancel",function(){var e=this.querySelector("ul");n.touchEventDone(e,event,t)})},touchEventDone:function(e,t,i){var n=this;switch(t=t||window.event,t.type){case"touchstart":n.startY=parseInt(t.touches[0].pageY),n.oldMoveY=n.startY,n.offset=n.getDistance(e),n.oldtime=(new Date).getTime();break;case"touchend":var a=(new Date).getTime();n.moveEndY=t.changedTouches[0].pageY;var s=n.moveEndY-n.startY,r=Math.abs(s/(a-n.oldtime));r=a-n.oldtime<200?1.5*r:r,n.curDistance=n.offset+s*(1+r);var c=Math.round(n.curDistance/n.config.liHeight);n.curDistance=c*n.config.liHeight,0==s&&"LI"==t.target.nodeName.toUpperCase()&&(n.curDistance=-1*t.target.offsetTop+n.config.liHeight*((n.config.itemNum-1)/2)),n.upDateDistance(e),n.currentIndexUl=i,n.positionArr[i]=n.curDistance,n.movePosition(e),n.selectedData(e);break;case"touchmove":t.preventDefault(),n.moveY=parseInt(t.touches[0].pageY),n.curDistance=n.offset+n.moveY-n.startY,n.movePosition(e);break;case"touchcancel":t.preventDefault(),n.curDistance=-1*t.target.offsetTop+n.config.liHeight*((n.config.itemNum-1)/2),n.upDateDistance(e),n.currentIndexUl=i,n.positionArr[i]=n.curDistance,n.movePosition(e),n.selectedData(e);break;default:return}},upDateDistance:function(e){var t=e.offsetHeight;this.curDistance<this.config.liHeight*((this.config.itemNum+1)/2)-t?this.curDistance=this.config.liHeight*((this.config.itemNum+1)/2)-t:this.curDistance>this.config.liHeight*((this.config.itemNum-1)/2)&&(this.curDistance=this.config.liHeight*((this.config.itemNum-1)/2))},getDistance:function(e){var t=0;return e.style.transform?t=parseInt(e.style.transform?e.style.transform.split(",")[1]:e.style.webkitTransform.split(",")[1]):t},getNowElement:function(e){return this.pickerSelect.querySelectorAll(e)},cssSet:function(){},toggleAnimate:function(e){var t=this.pickerSelect.querySelector(".picker-container");t.style.transform="translate3d(0,"+e.position+"px, 0)",t.style.opacity=e.opacity,this.pickerSelect.style.visibility=e.visibility,this.pickerSelect.style.opacity=e.opacity<1?0:e.opacity},hidePickerPanel:function(){this.toggleAnimate({visibility:"hidden",position:this.pickerHeight,opacity:.5})},getTextPosition:function(){var e=this.config.format,t=[];if("datetime"==this.config.type)if("string"==typeof this.value){var i=this.value.split(" ")[0].split("-"),n=this.value.split(" ")[1].split(":");t=t.concat(i,n)}else t=this.value;else t=this.value.split(e);if(this.config.cascade&&this.value.split(e).length<this.wheelCount)for(var a=0;a<this.wheelCount-this.value.split(e).length;a++)t.push("");this.SelectedDataArr=t;var s=[],r=this.config.liHeight;if(this.config.cascade){for(var c=!0,l=this.config.initData,a=0;a<this.wheelCount;a++){for(var o=0;o<l.length;o++)if(t[a]==l[o].value){var h=r*((this.config.itemNum-1)/2-o);if(s[a]=h,this.SelectedIndexArr[a]=o,!l[o].children){c=!1;break}l=l[o].children}""==t[a]&&(this.SelectedIndexArr[a]="empty",s[a]=r*((this.config.itemNum-1)/2))}this.replaceHtmlWheel()}else for(var a=0;a<t.length;a++)for(var d=this.getNowElement("ul")[a],u=d.getElementsByTagName("li"),f=u.length>0?u:[],o=0;o<f.length;o++){var g=f[o].innerHTML;if(g==t[a]){var h=r*((this.config.itemNum-1)/2-o);s[a]=h,this.SelectedIndexArr[a]=o,u[o].className="selected";break}u[o].className=""}return s},replaceHtmlWheel:function(){for(var e=this.currentIndexUl+1;e<this.wheelCount;){for(var t=this.config.initData,i=0;e>i;i++)t=t[this.SelectedIndexArr[i]].children?t[this.SelectedIndexArr[i]].children:[];for(var n="",a=0;a<t.length;a++)n+='<li data-key="'+t[a].id+'">'+t[a].value+"</li>";var s=this.getNowElement("ul")[e];s.innerHTML=n;var r=s.querySelectorAll("li");this.SelectedDataArr[e]=r.length>0?r[0].innerHTML:"",e++}for(var i=0;i<this.SelectedIndexArr.length;i++){var c=this.getNowElement("ul")[i],r=c.getElementsByTagName("li");"empty"!=this.SelectedIndexArr[i]&&(r[this.SelectedIndexArr[i]].className="selected")}},wheelInitPosition:function(){if(this.positionArr=[],""==this.value)for(var e=0;e<this.wheelCount;e++){this.positionArr[e]=this.config.liHeight*((this.config.itemNum-1)/2),this.SelectedIndexArr[e]=0;var t=this.getNowElement("ul")[e];this.SelectedDataArr[e]=t.querySelectorAll("li")[0].innerHTML,t.querySelectorAll("li")[0].className="selected"}else this.positionArr=this.getTextPosition();for(var i=0;i<this.positionArr.length;i++){this.curDistance=this.positionArr[i];var t=this.getNowElement("ul")[i];this.movePosition(t)}},movePosition:function(e){e.style.transform="translate3d("+this.translateLeft+"px, "+this.curDistance+"px, 0)",e.style.webkitTransform="translate3d("+this.translateLeft+"px, "+this.curDistance+"px, 0)"},selectedData:function(){var e=this.config.liHeight,t=this.positionArr,i=this.currentIndexUl,n=Math.abs(t[i]-e*((this.config.itemNum-1)/2))/e,a=this.getNowElement("ul")[i];this.SelectedIndexArr[i]=n;var s=a.querySelectorAll("li");if(s.length>0)for(var r=0;r<s.length;r++)s[r].className=n==r?"selected":"";this.SelectedDataArr[i]=s.length>0?s[n].innerHTML:"",this.config.cascade&&this.currentIndexUl<this.wheelCount-1&&this.updateWheel(),("date"==this.config.type||"datetime"==this.config.type)&&this.updateDayWheel()},updateDayWheel:function(){var e=this.SelectedDataArr,t=this.formatDays(e[0],e[1]),i=2;if(e.length>2&&(0==this.currentIndexUl||1==this.currentIndexUl)){for(var n="",a=0;a<t.length;a++){var s=e[i]==t[a]?"selected":"";n+='<li class="'+s+'">'+t[a]+"</li>"}var r=this.getNowElement("ul")[i];r.innerHTML=n;var c=r.querySelectorAll("li");this.SelectedDataArr[i]>t[t.length-1]&&(this.SelectedDataArr[i]=t[t.length-1],this.SelectedIndexArr[i]=t.length-1,c[t.length-1].className="selected",this.positionArr[i]=this.config.liHeight*((this.config.itemNum-1)/2-this.SelectedIndexArr[i]),this.curDistance=this.config.liHeight*((this.config.itemNum-1)/2-this.SelectedIndexArr[i]),this.movePosition(r))}},updateWheel:function(){for(var e=this.currentIndexUl+1;e<this.wheelCount;){for(var t=this.config.initData,i=0;e>i;i++)t=t[this.SelectedIndexArr[i]].children?t[this.SelectedIndexArr[i]].children:[];for(var n="",a=0;a<t.length;a++){var s=0==a?"selected":"";n+='<li class="'+s+'" data-key="'+t[a].id+'">'+t[a].value+"</li>"}var r=this.getNowElement("ul")[e];r.innerHTML=n;var c=r.querySelectorAll("li");this.SelectedDataArr[e]=c.length>0?c[0].innerHTML:"",this.positionArr[e]=this.config.liHeight*((this.config.itemNum-1)/2),this.SelectedIndexArr[e]=0,this.curDistance=this.config.liHeight*((this.config.itemNum-1)/2),this.movePosition(r),e++}},triggerWrapType:function(e,t){"INPUT"===this.tagName?e.value=t:e.innerHTML=t}},t=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define(function(){return e}):!("pickerSelect"in t)&&(t.pickerSelect=e)}();